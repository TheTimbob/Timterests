package web

import (
    "timterests/cmd/web/components"
)

templ LettersListPage(letters []Letter, tags []string, design string) {
	@Base("letters") {
		<div id="letters-container">
		    <div class="header-controls">
				<h1 class="category-title">Letters</h1>
				<div>
                	@components.FilterTags("/letters", tags)
                    @components.FilterDesign("/letters", design)
				</div>
			</div>
			@LettersList(letters, design)
		</div>
	}
}

templ LettersList(letters []Letter, design string) {
    <ul id="page-list" class="page-list">
		if design == "grid" {
			for i := 0; i < len(letters); i += 4 {
				<li class="grid-list-element">
					for j := i; j < i+4 && j < len(letters); j++ {
						@letters[j].ToCard(j).MiniCard()
					}
				</li>
			}
        } else if design == "links" {
            for i, letter := range letters {
                <li>
                    @letter.ToCard(i).LinkCard()
                </li>
            }
		} else {
        	for i, letter := range letters {
				<li>
    		        @letter.ToCard(i).LargeCard()
				</li>
			}
		}
	</ul>
}

templ LetterPage(letter Letter, userIsAdmin bool){
    @Base("letters") {
        @LetterDisplay(letter, userIsAdmin)
    }
}

templ LetterDisplay(letter Letter, userIsAdmin bool) {
    @EditLetterButton(letter, userIsAdmin)
    @components.DownloadDocumentButton(letter.Title, userIsAdmin)
    <div id="letter-container">
        <h1 class="category-title">{ letter.Title }</h1>
        <h2 class="category-subtitle">{ letter.Subtitle }</h2>
        @templ.Raw(letter.Body)
    </div>
}

templ EditLetterButton(letter Letter, userIsAdmin bool) {
    if userIsAdmin {
        <form hx-post="/writer" hx-target="body" class="action-form">
            <input type="hidden" name="document-type" value="letters"/>
            <input type="hidden" name="document-key" value={letter.S3Key}/>
            <input type="hidden" name="type-id" value={letter.ID}/>
            <button type="submit" class="button">Edit</button>
        </form>
    }
}
